<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<title>Show File Data</title>
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../flot/excanvas.min.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="../flot/jquery.js"></script> 
	<script language="javascript" type="text/javascript" src="../flot/jquery.flot.js"></script> 
	<script language="javascript" type="text/javascript" src="../flot/jquery.flot.crosshair.js"></script>
<style type='text/css'>
body {
	font-family: courier new, sans-serif;
	background:#aaf;
}

#drop_zone {
	text-align:center;
	background:#ccf;
	font-size:24px;
	color:#22a;
	padding:40px;
	border:5px dotted #44c;
}

#drop_zone.hover {
	background:#bbf;
}

.red { color:red; }

</style>
</head>
<body>

<div id="graph" style="width:100%;height:200px;"></div>

<div id="controls">
<input id="cutoff" type="text" value="0" />
<a onClick="cutoff = $('#cutoff').val()" href="javascript:void(0);">Apply cutoff</a> (in megabytes)
</div>
<br />

<div id="drop_zone">Drop files here</div>
<output id="list"></output>

<script>

  var cutoff = 0 //megabytes
  var files

  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    files = evt.dataTransfer.files; // FileList object.

    import_files()

    }

    function import_files() {

    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {

      // Only process image files.
      if (!f.type.match('image.*')) {
        continue;
      }

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(file) {
        return function(e) {
          // Render thumbnail -- too intensive!!
          // document.getElementById(file.name.split('.')[0]+"_img").innerHTML = ['<img class="thumb" src="', e.target.result,
          //                  '" title="', escape(file.name), '"/>'].join('');
        };
      })(f);

      // Read in the image file as a data URL.
      //reader.readAsDataURL(f);

      data[0].data.push([i,f.size])

      output.push('<li id="'+f.name.split('.')[0]+'"><div  id="'+f.name.split('.')[0]+'_img"></div><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');
    if (f.size > parseFloat(cutoff*1000000)) { 
	$('#'+f.name.split('.')[0]).addClass('red')
    console.log(f.name)
    console.log('chosen')
    }
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';

    plot = $.plot($("#graph"),data,flotoptions);
  }

  function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
    $('#drop_zone').addClass('hover')
  }

  // Setup the dnd listeners.
  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('dragout', function() { $('#drop_zone').removeClass('hover') }, false);
  dropZone.addEventListener('drop', handleFileSelect, false);

flotoptions = {
        series: {
                lines: { 
                        show: true, 
                        lineWidth: 1,
                },
        },
        crosshair: { mode: "x" },
        yaxis: { show: true, tickFormatter: function(n) { return (n/1000000)+"MB" } }, 
        xaxis: { show: true },
        shadowSize: 0,
        grid: {
                clickable: true,
                hoverable:true,
                borderWidth: 0,
                backgroundColor: "#eee"
        },
        // Palette "i eat the rainbow" by svartedauden on Colourlovers: http://www.colourlovers.com/palette/1630898/i_eat_the_rainbow, CC-BY-NC
        colors: [ "#333333", "#E02130", "#FAB243", "#429867", "#2B5166" ]//, "#482344" ]
}

	var data = [{label:"filesize",data:[]}]

	var plot = $.plot($("#graph"),data,flotoptions);

</script>

</script>


</body>
</html>
